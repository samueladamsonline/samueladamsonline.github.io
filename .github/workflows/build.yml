name: build
on:
  push:
    branches:
      - master
permissions:
  id-token: write
jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: Install Hugo
        run: |
          sudo apt-get update
          sudo apt-get install hugo=0.92.2-1ubuntu0.1
      - name: Checkout master branch
        uses: actions/checkout@v4
        with:
          ref: master
      - name: Generate HTML files
        run: hugo -d public
      - name: Add CNAME file
        run: echo "www.samueladams.dev" >> public/CNAME
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: public
  deploy:
    needs: build
    runs-on: ubuntu-22.04
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      # - name: Checkout gh-pages branch
      #   uses: actions/checkout@v2
      #   with:
      #     ref: gh-pages

      # - name: Push to gh-pages branch
      #   run: |
      #     if [[ -z $(git status --porcelain) ]]
      #     then
      #       echo "Push not needed"
      #     else
      #       git config --global user.name 'Samuel Adams'
      #       git config --global user.email 'samueladamsonline@gmail.com'
      #       git add .
      #       git commit -m "Deployment at $(date)."
      #       git push origin gh-pages
      #     fi